<!DOCTYPE html>
<html lang="zh-cn"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">论文阅读BGE-M3 | 徐慧志的个人博客</title>
<meta property="og:title" content="论文阅读BGE-M3 | 徐慧志的个人博客" />
<meta name="twitter:title" content="论文阅读BGE-M3 | 徐慧志的个人博客" />
<meta itemprop="name" content="论文阅读BGE-M3 | 徐慧志的个人博客" />
<meta name="application-name" content="论文阅读BGE-M3 | 徐慧志的个人博客" />
<meta property="og:site_name" content="" />

<meta name="description" content="Multi-Linguality, Multi-Functionality和Multi-Granularity">
<meta itemprop="description" content="Multi-Linguality, Multi-Functionality和Multi-Granularity" />
<meta property="og:description" content="Multi-Linguality, Multi-Functionality和Multi-Granularity" />
<meta name="twitter:description" content="Multi-Linguality, Multi-Functionality和Multi-Granularity" />

<meta property="og:locale" content="zh-cn" />
<meta name="language" content="zh-cn" />

  <link rel="alternate" hreflang="zh-cn" href="http://localhost:1313/zh-cn/know_how/20250613%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BBbge-m3/" title="中文 (简体)" />






<meta name="generator" content="Hugo 0.135.0">

    
    <meta property="og:url" content="http://localhost:1313/zh-cn/know_how/20250613%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BBbge-m3/">
  <meta property="og:site_name" content="徐慧志的个人博客">
  <meta property="og:title" content="论文阅读BGE-M3">
  <meta property="og:description" content="Multi-Linguality, Multi-Functionality和Multi-Granularity">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="know_how">
    <meta property="article:published_time" content="2025-06-13T13:45:40+00:00">
    <meta property="article:modified_time" content="2025-06-13T13:45:40+00:00">
    <meta property="article:tag" content="Tech">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="论文阅读BGE-M3">
  <meta name="twitter:description" content="Multi-Linguality, Multi-Functionality和Multi-Granularity">


    

    <link rel="canonical" href="http://localhost:1313/zh-cn/know_how/20250613%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BBbge-m3/">
    <link href="../../../style.min.e390ba7da26222f4dc42a349955d76dbbe44e5ce2535a43de5a70633a0a9ec3c.css" rel="stylesheet">
    <link href="../../../code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="../../../icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../icons/favicon-16x16.png">
    <link rel="mask-icon" href="../../../icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="../../../favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">
    <meta name="color-scheme" content="light dark">

    
    <link rel="icon" type="image/svg+xml" href="../../../icons/favicon.svg">

    
    
</head>
<body data-theme = "" class="notransition">

<script src="../../../js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/zh-cn/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>首页</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="../../../know_how/">
                        技术
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="../../../life/">
                        生活见闻
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="../../../page/about/">
                        关于
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="../../../link/">
                        宝藏集结
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="../../../tags/">
                        分类
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">论文阅读BGE-M3</h1>
                
                
                
                <div class="post-meta">
                    <time datetime="2025-06-13T13:45:40&#43;00:00" itemprop="datePublished"> Jun 13, 2025 </time>
                </div>
                
            </header>
            
    
    <details class="toc" ZgotmplZ>
        <summary><b>目录</b></summary>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#不同的向量检索方法">不同的向量检索方法</a></li>
    <li><a href="#dataset-sources">Dataset sources</a></li>
    <li><a href="#self-knowledge-distillation">Self-Knowledge Distillation</a></li>
    <li><a href="#training-process">Training Process</a></li>
    <li><a href="#batching-批处理策略">Batching 批处理策略</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#multi-lingual-retrieval">Multi-Lingual Retrieval</a></li>
        <li><a href="#cross-lingual-retrieval">Cross-Lingual Retrieval</a></li>
        <li><a href="#multilingual-long-doc-retrieval">Multilingual Long-Doc Retrieval</a></li>
        <li><a href="#ablation-study-消融实验">Ablation study 消融实验</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#dense-retrieval密集检索">Dense Retrieval（密集检索）</a></li>
        <li><a href="#sparselexical-retrieval稀疏检索">Sparse/lexical Retrieval（稀疏检索）</a></li>
        <li><a href="#multi-vector-retrieval多向量检索">Multi-Vector Retrieval（多向量检索）</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#为什么general-text-embedding发展如此迅速">为什么general text embedding发展如此迅速</a></li>
        <li><a href="#如何将向量模型从english拓展到multi-lingual">如何将向量模型从English拓展到multi-lingual</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </details>
            <div class="page-content">
                <p>论文地址：https://arxiv.org/abs/2402.03216</p>
<p>M3的意思是 Multi-Linguality, Multi-Functionality和Multi-Granularity</p>
<ul>
<li>支持100种语言（multi-lingual, cross-lingual)</li>
<li>支持短句和长文档，最高到8192tokesn</li>
<li>支持不同的检索方法</li>
</ul>
<p><img src="https://raw.githubusercontent.com/HuizhiXu/pictures/master/20250613/d5b741c9.png"></p>
<p>(图来源于论文)</p>
<h1 id="contribution">Contribution</h1>
<ol>
<li>实现了自知识蒸馏，将来自不同检索功能的相关性分数集成到教师信号，从而提高训练质量。</li>
<li>优化了批处理策略，实现较大的批处理大小和高训练吞吐量，以提高Embedding的区分能力。</li>
<li>用data curation来得到高质量的数据</li>
</ol>
<h1 id="细节">细节</h1>
<h2 id="不同的向量检索方法">不同的向量检索方法</h2>
<ul>
<li>[CLS]用来做dense retrieval</li>
<li>其他token的向量用来做sparse retrieval 和multi-vector retrieval</li>
</ul>
<h2 id="dataset-sources">Dataset sources</h2>
<ul>
<li>extract the unsupervised data from massive multi-lingual corpora</li>
<li>Integrate the closely related supervised data</li>
<li>Synthesize the scarce data</li>
</ul>
<h2 id="self-knowledge-distillation">Self-Knowledge Distillation</h2>
<p>InfoNCE loss 的目标是最大化正样本对的相似度，同时最小化负样本对的相似度。</p>
<p>InfoNCE loss的计算</p>
<p>$$Loss= -log \frac{ \exp(sim(x_i,x_i^+)/\tau) }{\sum_{j=1}^K \exp(sim(x_i, x_i^{-j})/\tau) }$$</p>
<p>假设我们有一个数据集，其中每个样本 xi 有一个对应的正样本 $$x_i^+$$ 和多个负样本 $$x_i^{-1}, x_i^{-2}, &hellip;, x_i^{-K} $$。</p>
<p>对于每个样本 $$x_i$$，我们希望其与正样本 $$x_i^+ $$的相似度尽可能高。</p>
<p>$$x_i$$与所有负样本的相似度尽可能低。多目标训练时多个目标会产生冲突，所以本文提出了self-knowledge distillation。</p>
<p>用了Ensemble Learning 的的概念： $$L = (\lambda_1 L_{dense} + \lambda_2 L_{lex} + \lambda_3 L_{mul} + L_{inter})/4
$$</p>
<h2 id="training-process">Training Process</h2>
<ol>
<li>XLM-RoBERTa is pre-trained with unsupervised data</li>
<li>Self-Knowledge Distillation, three retrieval functionalities is fine-tuned with supervised data</li>
<li>Synthesized data especially hard negative samples</li>
</ol>
<h2 id="batching-批处理策略">Batching 批处理策略</h2>
<p>Batchsize 必须很大，才能保证差异性。在有限的GPU资源的情况下，人们的做法通常是把输入数据切割成小序列来进行实验。但是M3-Embedding需要同时处理长文本和短序列。</p>
<p>优化策略</p>
<ul>
<li>
<p>先将训练数据依据序列长度进行分组，生成小批量数据（mini-batch）时，从同一组里采样数据实例。——这种方法减少了padding操作，提升 GPU 的利用效率。</p>
</li>
<li>
<p>固定random seed，在做训练数据的采样的时候——这个可以保证各 GPU 分到的数据分布均衡，降低单个训练步骤中的等待时间。</p>
</li>
<li>
<p>处理长序列训练数据时，把 mini-batch 分成更小的子批次，借助梯度检查点技术依次编码各子批次并收集嵌入向量，能极大增加批量大小，降低内存占用。
例子：处理长度为 8192 的文本序列，初始批量大小可能受限于内存只能是 1。将其 mini-batch 分为 10 个子批次，每个子批次长度为 819.2（实际可能取整），利用梯度检查点依次编码每个子批次，最终收集所有嵌入向量，这样批量大小可能增大到 20 以上，相比原来提升了超 20 倍，有效利用有限内存完成更大规模训练。</p>
</li>
<li>
<p>在分布式环境下，把各 GPU 得到的嵌入向量进行广播，使每块 GPU 都能获取到全部嵌入向量，从而扩大在 batch 内可用于对比学习等任务的负样本规模。</p>
</li>
<li>
<p>MCLS (Multi-CLS)</p>
</li>
</ul>
<h1 id="实验">实验</h1>
<h3 id="multi-lingual-retrieval">Multi-Lingual Retrieval</h3>
<ul>
<li>数据集：使用MIRACL (Zhang et al., 2023c) 数据集，包含18种语言的检索任务，每个任务都由查询和文档组成，查询和文档为同一种语言。</li>
<li>评估指标：主要使用nDCG@10作为评估指标，同时也计算了Recall@100的结果。</li>
<li>检索方法</li>
<li>Baseline</li>
<li>结果</li>
</ul>
<h3 id="cross-lingual-retrieval">Cross-Lingual Retrieval</h3>
<ul>
<li>数据集：使用MKQA 数据集，包含25种非英语的查询。每个任务都由非英语的查询和英语的文档组成。文章里使用的数据集是经过处理之后的BEIR。</li>
<li>评估指标：使用Recall@100作为评估指标，同时也计算了Recall@20的结果。</li>
<li>结果</li>
</ul>
<h3 id="multilingual-long-doc-retrieval">Multilingual Long-Doc Retrieval</h3>
<ul>
<li>数据集：</li>
<li>Baseline: 除了前面的基线模型，还新增了长文本模型，例如JinaEmbeddingv2 和text-embedding-3-large。</li>
<li>评估指标：使用Recall@100作为评估指标，同时也计算了Recall@20的结果。</li>
<li>结果</li>
</ul>
<h3 id="ablation-study-消融实验">Ablation study 消融实验</h3>
<p>消融实验通过有选择地移除或修改系统中的某些部分，来观察这些变化对整体性能的影响。（消融实验是针对创新点的对照实验，通过对比来表明创新点的有效性）</p>
<ul>
<li>为了探索self-knowledge distillation的影响，进行消融实验。</li>
<li>为了探索multi-stage-training的影响，进行消融实验。</li>
<li>为了探索M3-Embedding在长文档检索中的竞争力，进行了消融实验</li>
</ul>
<h1 id="术语和概念">术语和概念</h1>
<h3 id="dense-retrieval密集检索">Dense Retrieval（密集检索）</h3>
<ul>
<li>含义：密集检索是一种将文本映射到一个单一的嵌入向量（embedding）的检索方式。根据向量的相似度来进行检索。</li>
<li>用[CLS]或者mean-pooling
dense retrieval, where relevant answers to the query can be retrieved based on the embedding similarity.</li>
</ul>
<p>参考文献：Karpukhin et al., 2020;Xiong et al., 2020; Nee-lakantan et al., 2022; Wang et al., 2022; Xiao et al.,2023</p>
<h3 id="sparselexical-retrieval稀疏检索">Sparse/lexical Retrieval（稀疏检索）</h3>
<ul>
<li>含义：稀疏检索是根据文本中出现的词汇（token）来计算权重，并基于这些权重来进行检索。</li>
<li>它不会像密集检索那样将文本整体映射到一个向量，而是关注文本中的每一个词汇。例如，对于文本“今天天气很好”，它会分别计算“今天”“天气”“很”“好”这些词汇的权重。然后根据这些权重来衡量文本之间的相似度。比如，如果另一个文本中“天气”和“好”这两个词的权重也很高，那么这两个文本在稀疏检索中可能会被认为是相似的。</li>
<li>weight通过relu来计算
参考文献：Gao et al., 2021a; Lin andMa,2021; Dai and Callan,2020</li>
</ul>
<h3 id="multi-vector-retrieval多向量检索">Multi-Vector Retrieval（多向量检索）</h3>
<ul>
<li>含义：多向量检索是使用多个向量来表示一个文本的检索方式。</li>
<li>与密集检索用一个向量表示文本不同，多向量检索会将文本分解成多个部分，每个部分用一个向量来表示。例如，对于一个长文本，可以将其分成几个段落，每个段落用一个向量来表示。或者对于一个复杂的概念，可以用多个向量从不同角度来表示。然后在检索时，会综合考虑这些向量来衡量文本之间的相似度。
参考文献：Khattaband Zaharia,2020</li>
</ul>
<h1 id="其他">其他</h1>
<h3 id="为什么general-text-embedding发展如此迅速">为什么general text embedding发展如此迅速</h3>
<ol>
<li>
<p>预训练语言模型的普及，让文本的语义能够被很好地encode</p>
</li>
<li>
<p>Contrastive learning特别是negative sampling的发展</p>
</li>
<li>
<p>知识蒸馏的利用</p>
</li>
<li>
<p>学习多功能的嵌入模型变得越来越流行，这些模型能够统一支持各种应用场景</p>
</li>
<li>
<ol>
<li></li>
</ol>
</li>
<li>
<ol start="2">
<li></li>
</ol>
</li>
<li>
<ol start="3">
<li></li>
</ol>
</li>
<li>
<ol start="4">
<li></li>
</ol>
</li>
</ol>
<h3 id="如何将向量模型从english拓展到multi-lingual">如何将向量模型从English拓展到multi-lingual</h3>
<ul>
<li>预训练多语言文本编码器（Pretrained multi-lingual text-encoders）的发展，例如 mBERT (Pires et al., 2019), mT5 (Xue et al., 2021), XLM-R (Conneau et al., 2020)</li>
<li>多语言语料的发展，例如MIRACL (Zhang et al., 2023c), mMARCO (Bonifacio et al., 2021), Mr. TyDi (Zhang et al., 2021b), MKQA(Longpreetal., 2021).</li>
<li>多语言嵌入模型的发展，例如mDPR (Zhang et al., 2023b), mContriever (Izacard et al., 2022), mE5 (Wang et al., 2022)</li>
</ul>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
</div>
    <small class="footer_copyright">
        © 2025 .
        Powered by <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noopener">Hugo blog awesome</a>.
    </small>
</footer>







    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
