<!DOCTYPE html>
<html lang="chs" itemscope itemtype="http://schema.org/WebPage"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="../../../favicon.svg">

  <title>
  2025-06-26 论文阅读 Qwen3 Embedding - 徐慧志的个人博客
  </title>
  <meta name="description" content="论文地址：https://arxiv.org/pdf/2506.05176
Contribution

基于合成数据的multi-stage训练
构建高质量合成数据
引入模型合并（model merging）

细节
模型
Embedding Models

所有嵌入模型均基于 Qwen3 基座大模型构建；
使用带因果注意力（causal attention）的解码式架构；
在输入序列的末尾添加 [EOS]，使用其最终一层 hidden state 作为 embedding 表示；
支持带指令输入（instruction），格式为： {Instruction} {Query}&lt;|endoftext|&gt;；
官方实验显示：相比无 instruction，指令式输入能显著提升效果；
支持 MRL。

Reranking Models

采用 point-wise reranking with LLMs within a single context：point-wise reranking是指 大型语言模型会对每个候选项单独评估其与查询的相关性，给出一个分数，然后根据这些分数进行排序。
支持 instruction 输入，prompt 格式如下：

&lt;|im_start|&gt;system
Judge whether the Document meets the requirements based on the Query and the
Instruct provided. Note that the answer can only be &#34;yes&#34; or
&#34;no&#34;.&lt;|im_end|&gt;
, →, →
&lt;|im_start|&gt;user
&lt;Instruct&gt;: {Instruction}
&lt;Query&gt;: {Query}
&lt;Document&gt;: {Document}&lt;|im_end|&gt;
&lt;|im_start|&gt;assistant
&lt;think&gt;\n\n&lt;/think&gt;\n\n
训练
训练目标
Embedding 模型采用 InfoNCE 对比损失" /><meta name="generator" content="Hugo 0.135.0"><link
    rel="stylesheet"
    href="/css/styles.min.9af39941a3807f10eba8dd56da5fe9f28076ed2722ec76c1aa643b6d55afedbd.css"
    integrity=""
    crossorigin="anonymous"
  />
  
  

  
  <meta property="og:url" content="https://huizhixu.github.io/chs/know_how/20250626%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BBqwen3-embedding/">
  <meta property="og:site_name" content="徐慧志的个人博客">
  <meta property="og:title" content="2025-06-26 论文阅读 Qwen3 Embedding">
  <meta property="og:description" content="论文地址：https://arxiv.org/pdf/2506.05176
Contribution 基于合成数据的multi-stage训练 构建高质量合成数据 引入模型合并（model merging） 细节 模型 Embedding Models 所有嵌入模型均基于 Qwen3 基座大模型构建； 使用带因果注意力（causal attention）的解码式架构； 在输入序列的末尾添加 [EOS]，使用其最终一层 hidden state 作为 embedding 表示； 支持带指令输入（instruction），格式为： {Instruction} {Query}&lt;|endoftext|&gt;； 官方实验显示：相比无 instruction，指令式输入能显著提升效果； 支持 MRL。 Reranking Models 采用 point-wise reranking with LLMs within a single context：point-wise reranking是指 大型语言模型会对每个候选项单独评估其与查询的相关性，给出一个分数，然后根据这些分数进行排序。 支持 instruction 输入，prompt 格式如下： &lt;|im_start|&gt;system Judge whether the Document meets the requirements based on the Query and the Instruct provided. Note that the answer can only be &#34;yes&#34; or &#34;no&#34;.&lt;|im_end|&gt; , →, → &lt;|im_start|&gt;user &lt;Instruct&gt;: {Instruction} &lt;Query&gt;: {Query} &lt;Document&gt;: {Document}&lt;|im_end|&gt; &lt;|im_start|&gt;assistant &lt;think&gt;\n\n&lt;/think&gt;\n\n 训练 训练目标 Embedding 模型采用 InfoNCE 对比损失">
  <meta property="og:locale" content="chs">
  <meta property="og:type" content="article">
    <meta property="article:section" content="know_how">
    <meta property="article:published_time" content="2025-06-26T13:55:03+00:00">
    <meta property="article:modified_time" content="2025-06-26T13:55:03+00:00">
    <meta property="article:tag" content="Tech">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="2025-06-26 论文阅读 Qwen3 Embedding">
  <meta name="twitter:description" content="论文地址：https://arxiv.org/pdf/2506.05176
Contribution 基于合成数据的multi-stage训练 构建高质量合成数据 引入模型合并（model merging） 细节 模型 Embedding Models 所有嵌入模型均基于 Qwen3 基座大模型构建； 使用带因果注意力（causal attention）的解码式架构； 在输入序列的末尾添加 [EOS]，使用其最终一层 hidden state 作为 embedding 表示； 支持带指令输入（instruction），格式为： {Instruction} {Query}&lt;|endoftext|&gt;； 官方实验显示：相比无 instruction，指令式输入能显著提升效果； 支持 MRL。 Reranking Models 采用 point-wise reranking with LLMs within a single context：point-wise reranking是指 大型语言模型会对每个候选项单独评估其与查询的相关性，给出一个分数，然后根据这些分数进行排序。 支持 instruction 输入，prompt 格式如下： &lt;|im_start|&gt;system Judge whether the Document meets the requirements based on the Query and the Instruct provided. Note that the answer can only be &#34;yes&#34; or &#34;no&#34;.&lt;|im_end|&gt; , →, → &lt;|im_start|&gt;user &lt;Instruct&gt;: {Instruction} &lt;Query&gt;: {Query} &lt;Document&gt;: {Document}&lt;|im_end|&gt; &lt;|im_start|&gt;assistant &lt;think&gt;\n\n&lt;/think&gt;\n\n 训练 训练目标 Embedding 模型采用 InfoNCE 对比损失">

  
  <meta itemprop="name" content="2025-06-26 论文阅读 Qwen3 Embedding">
  <meta itemprop="description" content="论文地址：https://arxiv.org/pdf/2506.05176
Contribution 基于合成数据的multi-stage训练 构建高质量合成数据 引入模型合并（model merging） 细节 模型 Embedding Models 所有嵌入模型均基于 Qwen3 基座大模型构建； 使用带因果注意力（causal attention）的解码式架构； 在输入序列的末尾添加 [EOS]，使用其最终一层 hidden state 作为 embedding 表示； 支持带指令输入（instruction），格式为： {Instruction} {Query}&lt;|endoftext|&gt;； 官方实验显示：相比无 instruction，指令式输入能显著提升效果； 支持 MRL。 Reranking Models 采用 point-wise reranking with LLMs within a single context：point-wise reranking是指 大型语言模型会对每个候选项单独评估其与查询的相关性，给出一个分数，然后根据这些分数进行排序。 支持 instruction 输入，prompt 格式如下： &lt;|im_start|&gt;system Judge whether the Document meets the requirements based on the Query and the Instruct provided. Note that the answer can only be &#34;yes&#34; or &#34;no&#34;.&lt;|im_end|&gt; , →, → &lt;|im_start|&gt;user &lt;Instruct&gt;: {Instruction} &lt;Query&gt;: {Query} &lt;Document&gt;: {Document}&lt;|im_end|&gt; &lt;|im_start|&gt;assistant &lt;think&gt;\n\n&lt;/think&gt;\n\n 训练 训练目标 Embedding 模型采用 InfoNCE 对比损失">
  <meta itemprop="datePublished" content="2025-06-26T13:55:03+00:00">
  <meta itemprop="dateModified" content="2025-06-26T13:55:03+00:00">
  <meta itemprop="wordCount" content="734">
  <meta itemprop="keywords" content="Tech">

  
  <meta name="lang" content="chs" />
  

  
</head>
<body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative">
  <a href="https://huizhixu.github.io/chs/" class="capitalize font-extrabold text-2xl">
    
    <img src="../../../blist-logo.png" alt="徐慧志的个人博客" class="h-8 max-w-full" />
    
  </a>
  <button class="mobile-menu-button md:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <line x1="4" y1="8" x2="20" y2="8" />
      <line x1="4" y1="16" x2="20" y2="16" />
    </svg>
  </button>
  <ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800">

    
    <li><a href="../../../chs/know_how/">技术</a></li>
    
    <li><a href="../../../chs/life/">生活见闻</a></li>
    
    <li><a href="../../../chs/page/about/">关于</a></li>
    
    <li><a href="../../../chs/link/">宝藏集结</a></li>
    
    <li><a href="../../../chs/tags/">分类</a></li>
    

    
    
    <li class="relative cursor-pointer">
      <span class="language-switcher flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
          stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="12" cy="12" r="9" />
          <line x1="3.6" y1="9" x2="20.4" y2="9" />
          <line x1="3.6" y1="15" x2="20.4" y2="15" />
          <path d="M11.5 3a17 17 0 0 0 0 18" />
          <path d="M12.5 3a17 17 0 0 1 0 18" />
        </svg>
        <a>语言</a>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14"
          viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round"
          stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M18 15l-6 -6l-6 6h12" transform="rotate(180 12 12)" />
        </svg>
      </span>
      <div
        class="language-dropdown absolute top-full mt-2 left-0 flex-col gap-2 bg-gray-100 dark:bg-gray-900 dark:text-white z-10 hidden">
        
        
        
        
        <a class="px-3 py-2 hover:bg-gray-200 dark:hover:bg-gray-700" href="../../../en/" lang="en">English</a>
        
        
        
        <a class="px-3 py-2 hover:bg-gray-200 dark:hover:bg-gray-700" href="../../../de/" lang="de">Deutsch</a>
        
        
      </div>
    </li>
    
    

    
    <li class="grid place-items-center">
      <span class="open-search inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="10" cy="10" r="7" />
          <line x1="21" y1="21" x2="15" y2="15" />
        </svg>
      </span>
    </li>
    

    
    <li class="grid place-items-center">
      <span class="toggle-dark-mode inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="12" cy="12" r="3" />
          <line x1="12" y1="5" x2="12" y2="5.01" />
          <line x1="17" y1="7" x2="17" y2="7.01" />
          <line x1="19" y1="12" x2="19" y2="12.01" />
          <line x1="17" y1="17" x2="17" y2="17.01" />
          <line x1="12" y1="19" x2="12" y2="19.01" />
          <line x1="7" y1="17" x2="7" y2="17.01" />
          <line x1="5" y1="12" x2="5" y2="12.01" />
          <line x1="7" y1="7" x2="7" y2="7.01" />
        </svg>
      </span>
    </li>
    
  </ul>
</header>
<main class="flex-1">
  
  

  

  <article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4">

    <h1 class="text-2xl font-bold mb-2">2025-06-26 论文阅读 Qwen3 Embedding</h1>
    
    <h5 class="text-sm flex items-center flex-wrap">
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <rect x="4" y="5" width="16" height="16" rx="2" />
        <line x1="16" y1="3" x2="16" y2="7" />
        <line x1="8" y1="3" x2="8" y2="7" />
        <line x1="4" y1="11" x2="20" y2="11" />
        <rect x="8" y="15" width="2" height="2" />
      </svg>
      发布于 
  
    2025年06月26日
  

      
        &nbsp;&bull;&nbsp;
      
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <circle cx="12" cy="12" r="9" />
        <polyline points="12 7 12 12 15 15" />
      </svg>
     4&nbsp;分钟
     
      &nbsp;&bull;
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <line x1="3" y1="6" x2="3" y2="19" />
        <line x1="12" y1="6" x2="12" y2="19" />
        <line x1="21" y1="6" x2="21" y2="19" />
      </svg>
      734&nbsp;字

    </h5>
    

    <details id="TableOfContents" class="px-4 mt-4 bg-gray-100 dark:bg-gray-700 rounded toc">
    <summary class="flex items-center font-bold py-2 px-4 cursor-pointer justify-between select-none text-black dark:text-white">
      <span>Table of contents</span>
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <polyline points="6 9 12 15 18 9"></polyline>
     </svg>
    </summary>

    <ul class="mt-2 pb-4">
        

        
        <li>
        <a href="#contribution">Contribution</a>
        

        
        </li><li>
        <a href="#%e7%bb%86%e8%8a%82">细节</a>
        

        
        <ul>
            <li>
        <a href="#%e6%a8%a1%e5%9e%8b">模型</a>
        

        
        <ul>
            <li>
        <a href="#embedding-models">Embedding Models</a>
        

        
        </li><li>
        <a href="#reranking-models">Reranking Models</a>
        

        
        </li></ul>
      </li><li>
        <a href="#%e8%ae%ad%e7%bb%83">训练</a>
        

        
        <ul>
            <li>
        <a href="#%e8%ae%ad%e7%bb%83%e7%9b%ae%e6%a0%87">训练目标</a>
        

        
        </li><li>
        <a href="#multi-stage-training">Multi-stage training</a>
        

        
        </li></ul>
      </li><li>
        <a href="#%e6%95%b0%e6%8d%ae%e5%90%88%e6%88%90">数据合成</a>
        

        
        <ul>
            <li>
        <a href="#%e4%bb%a5retrieval-%e4%bb%bb%e5%8a%a1%e6%95%b0%e6%8d%ae%e5%90%88%e6%88%90%e4%b8%ba%e4%be%8b">以Retrieval 任务数据合成为例</a>
        

        
        </li><li>
        <a href="#%e6%95%b0%e6%8d%ae%e8%bf%87%e6%bb%a4">数据过滤</a>
        

        
        </li></ul>
      </li><li>
        <a href="#%e6%95%b0%e6%8d%ae">数据</a>
        

        
        </li><li>
        <a href="#%e8%af%84%e4%bc%b0%e5%92%8c%e7%bb%93%e6%9e%9c">评估和结果</a>
        

        
        </li><li>
        <a href="#%e6%b6%88%e8%9e%8d%e5%ae%9e%e9%aa%8c">消融实验</a>
        

        
        </li></ul>
      </li><li>
        <a href="#%e6%9c%af%e8%af%ad%e5%92%8c%e6%a6%82%e5%bf%b5">术语和概念</a>
        

        
        <ul>
            <li>
        <a href="#%e5%9b%a0%e6%9e%9c%e6%b3%a8%e6%84%8f%e5%8a%9bcausal-attention">因果注意力（Causal Attention）</a>
        

        
        </li><li>
        <a href="#rerank-%e6%96%b9%e6%b3%95">Rerank 方法</a>
        

        
        <ul>
            <li>
        <a href="#mrl">MRL</a>
        

        
        </li><li>
        <a href="#spherical-linear-interpolation-%e7%90%83%e7%8a%b6%e7%ba%bf%e6%80%a7%e5%b7%ae%e5%80%bcslerp">spherical linear interpolation 球状线性差值(slerp)</a>
        

        
        </li></ul>
      </li></ul>
      </li><li>
        <a href="#%e5%85%b6%e4%bb%96">其他</a>
        </li></ul>
  </details>

    <p>论文地址：https://arxiv.org/pdf/2506.05176</p>
<h1 id="contribution">Contribution</h1>
<ol>
<li>基于合成数据的multi-stage训练</li>
<li>构建高质量合成数据</li>
<li>引入模型合并（model merging）</li>
</ol>
<h1 id="细节">细节</h1>
<h2 id="模型">模型</h2>
<h3 id="embedding-models">Embedding Models</h3>
<ul>
<li>所有嵌入模型均基于 Qwen3 基座大模型构建；</li>
<li>使用带因果注意力（causal attention）的解码式架构；</li>
<li>在输入序列的末尾添加 [EOS]，使用其最终一层 hidden state 作为 embedding 表示；</li>
<li>支持带指令输入（instruction），格式为： {Instruction} {Query}&lt;|endoftext|&gt;；</li>
<li>官方实验显示：相比无 instruction，指令式输入能显著提升效果；</li>
<li>支持 MRL。</li>
</ul>
<h3 id="reranking-models">Reranking Models</h3>
<ul>
<li>采用 point-wise reranking with LLMs within a single context：point-wise reranking是指 大型语言模型会对每个候选项单独评估其与查询的相关性，给出一个分数，然后根据这些分数进行排序。</li>
<li>支持 instruction 输入，prompt 格式如下：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>&lt;|im_start|&gt;system
</span></span><span style="display:flex;"><span>Judge whether the Document meets the requirements based on the Query and the
</span></span><span style="display:flex;"><span>Instruct provided. Note that the answer can only be &#34;yes&#34; or
</span></span><span style="display:flex;"><span>&#34;no&#34;.&lt;|im_end|&gt;
</span></span><span style="display:flex;"><span>, →, →
</span></span><span style="display:flex;"><span>&lt;|im_start|&gt;user
</span></span><span style="display:flex;"><span>&lt;Instruct&gt;: {Instruction}
</span></span><span style="display:flex;"><span>&lt;Query&gt;: {Query}
</span></span><span style="display:flex;"><span>&lt;Document&gt;: {Document}&lt;|im_end|&gt;
</span></span><span style="display:flex;"><span>&lt;|im_start|&gt;assistant
</span></span><span style="display:flex;"><span>&lt;think&gt;\n\n&lt;/think&gt;\n\n
</span></span></code></pre></div><h2 id="训练">训练</h2>
<h3 id="训练目标">训练目标</h3>
<p>Embedding 模型采用 InfoNCE 对比损失</p>
<p>$$Loss= -log \frac{ \exp(sim(x_i,x_i^+)/\tau) }{\sum_{j=1}^K \exp(sim(x_i, x_i^{-j})/\tau) }$$</p>
<ul>
<li>InfoNCE loss 的目标是最大化正样本对的相似度，同时最小化负样本对的相似度。</li>
<li>负样本包括硬负样本、批内负样本等
Reranking 模型采用 SFT（二分类交叉熵）损失</li>
</ul>
<p>$$L_{reranking}= -log p(l \mid P(q,d))$$</p>
<ul>
<li>通过SFT 训练 LLM 作为一个判别器，让它逐项评估候选段落是否与查询匹配。这种 point-wise reranking 方法不要求文档之间直接比较，仅需模型判断每个文档的相关性强弱。</li>
<li>优化目标是最大化模型给正确标签（yes/no）打的概率，也就是：</li>
<li>公式说明</li>
</ul>
<h3 id="multi-stage-training">Multi-stage training</h3>
<p><img src="https://raw.githubusercontent.com/HuizhiXu/pictures/master/20250626/8cf132c8.png"></p>
<p>分为三阶段：</p>
<p>第一阶段：大规模的合成数据驱动的弱监督学习</p>
<p>Large-Scale Synthetic Data-Driven Weak Supervision Training</p>
<p>之前的GTE, E5, BGE models的数据主要来源于开源社区，Qwen3 的创新点在于使用基座模型来合成数据。根据不同维度的需要来生成，例如task, language, length和difficulty。与开源数据相比，合成数据更加可控，具有多样性。</p>
<p>第二阶段：SFT阶段利用高质量合成数据进行监督学习</p>
<p>High-Quality Synthetic Data Utilization in Supervised Fine Tuning</p>
<p>对筛选出的高质量合成数据（相似度 &gt; 0.7）和公开监督数据集（如 MS MARCO、MIRACL 等）进行监督训练。</p>
<p>第三阶段：模型合并（Model Merging）</p>
<p>在SFT之后，对筛选出的高质量合成数据（相似度 &gt; 0.7）和公开监督数据集（如 MS MARCO、MIRACL 等）进行监督训练。</p>
<p>注意：</p>
<p>Reranking模型的训练补不包含第一阶段的弱监督训练。</p>
<h2 id="数据合成">数据合成</h2>
<p>Qwen3 的训练体系引入了四类任务合成数据：</p>
<ul>
<li>Retrieval（信息检索）</li>
<li>Bitext Mining（比对挖掘）</li>
<li>Classification（分类）</li>
<li>Semantic Textual Similarity（STS，语义文本相似度）
数据合成使用的模型为 Qwen3-32B，语料来源是Qwen3 基座模型预训练阶段的多语言数据集。</li>
</ul>
<h3 id="以retrieval-任务数据合成为例">以Retrieval 任务数据合成为例</h3>
<p>数据合成分为两个阶段：</p>
<ol>
<li>配置阶段（Configuration）
Template 如下：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>Given a **Passage** and **Character**, select the appropriate option from
</span></span><span style="display:flex;"><span>three fields: Character, Question_Type, Difficulty, and return the output
</span></span><span style="display:flex;"><span>in JSON format.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>First, select the Character who are likely to be interested in the Passage
</span></span><span style="display:flex;"><span>from the candidates. Then select the Question_Type that the Character
</span></span><span style="display:flex;"><span>might ask about the Passage; Finally, choose the Difficulty of the
</span></span><span style="display:flex;"><span>possible question based on the Passage, the Character, and the
</span></span><span style="display:flex;"><span>Question_Type.
</span></span><span style="display:flex;"><span>Character: Given by input **Character**
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Question_Type:
</span></span><span style="display:flex;"><span>- keywords: ...
</span></span><span style="display:flex;"><span>- acquire_knowledge: ...
</span></span><span style="display:flex;"><span>- summary: ...
</span></span><span style="display:flex;"><span>- yes_or_no: ...
</span></span><span style="display:flex;"><span>- background: ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Difficulty:
</span></span><span style="display:flex;"><span>- high_school: ...
</span></span><span style="display:flex;"><span>- university: ...
</span></span><span style="display:flex;"><span>- phd: ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Here are some examples
</span></span><span style="display:flex;"><span>&lt;Example1&gt; &lt;Example2&gt; &lt;Example3&gt;
</span></span><span style="display:flex;"><span>Now, generate the **output** based on the **Passage** and **Character** from
</span></span><span style="display:flex;"><span>user, the **Passage** will be in {language} language and the **Character**
</span></span><span style="display:flex;"><span>will be in English.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Ensure to generate only the JSON output with content in English.
</span></span><span style="display:flex;"><span>**Passage**:
</span></span><span style="display:flex;"><span>{passage}
</span></span><span style="display:flex;"><span>**Character**:
</span></span><span style="display:flex;"><span>{character}
</span></span></code></pre></div><p>拆解这个prompt：</p>
<p>输入：一段多语种文档（Passage）和角色（Character）</p>
<p>使用 LLM（如 Qwen3-32B）生成：</p>
<ul>
<li>Character：对该文档感兴趣的角色（从 Persona Hub 中检索 Top-5 候选）</li>
<li>Question_Type：角色可能提出的问题类型（如关键词、背景、摘要等）</li>
<li>Difficulty：问题的难度等级（高中/大学/博士）
输出（JSON 格式）：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;Character&#34;: &#34;...&#34;,
</span></span><span style="display:flex;"><span>  &#34;Question_Type&#34;: &#34;...&#34;,
</span></span><span style="display:flex;"><span>  &#34;Difficulty&#34;: &#34;...&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol>
<li>查询生成阶段（Query Generation）
基于上述配置，LLM 生成一个自然语言查询（Query），用于构造 (query, document) 检索训练对。</li>
</ol>
<p>template为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>Given a **Character**, **Passage**, and **Requirement**, generate a query from
</span></span><span style="display:flex;"><span>the **Character**&#39;s perspective that satisfies the **Requirement** and can
</span></span><span style="display:flex;"><span>be used to retrieve the **Passage**. Please return the result in JSON
</span></span><span style="display:flex;"><span>format.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Here is an example:
</span></span><span style="display:flex;"><span>&lt;example&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Now, generate the **output** based on the **Character**, **Passage** and
</span></span><span style="display:flex;"><span>**Requirement** from user, the **Passage** will be in {corpus_language}
</span></span><span style="display:flex;"><span>language, the **Character** and **Requirement** will be in English.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Ensure to generate only the JSON output, with the key in English and the value
</span></span><span style="display:flex;"><span>in {queries_language} language.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>**Character**
</span></span><span style="display:flex;"><span>{character}
</span></span><span style="display:flex;"><span>**Passage**
</span></span><span style="display:flex;"><span>{passage}
</span></span><span style="display:flex;"><span>**Requirment**
</span></span><span style="display:flex;"><span>- Type: {type};
</span></span><span style="display:flex;"><span>- Difficulty: {difficulty};
</span></span><span style="display:flex;"><span>- Length: the length of the generated sentences should be {length} words;
</span></span><span style="display:flex;"><span>- Languange: the language in which the results are generated should be
</span></span><span style="display:flex;"><span>{language} language;
</span></span></code></pre></div><p>拆解这个prompt：</p>
<p>输入：</p>
<ul>
<li>
<p>Character：一个角色设定，代表提问者的身份、兴趣或背景（如“a university student interested in ancient Chinese astronomy”）。</p>
</li>
<li>
<p>Passage：一段多语种文档，作为检索目标。</p>
</li>
<li>
<p>Requirement：一个结构化配置，包含：
输出：</p>
</li>
<li>
<p>仅输出 JSON 格式；</p>
</li>
<li>
<p>JSON 的 key 为英文，value 为指定语言；</p>
</li>
<li>
<p>查询必须从 Character 的视角出发，满足指定的 Requirement，并能用于检索该 Passage。</p>
</li>
</ul>
<h3 id="数据过滤">数据过滤</h3>
<p>对每一对数据计算cosine相似度，选择相似度大于0.7的数据作为高质量数据。</p>
<h2 id="数据">数据</h2>
<p>第一阶段 Weakly Supervised Pre-Traning</p>
<ul>
<li>
<p>数据来源：合成数据</p>
</li>
<li>
<p>数量：150M（ 1亿5千万）
第二阶段 Supervised Fine Tuning</p>
</li>
<li>
<p>数据来源：MS MARCO, NQ, HotpotQA, NLI, Dureader, T2 -Ranking, SimCLUE, MIRACL, MLDR, Mr.TyDi, Multi-CPR, CodeSearchNet .etc + 高质量合成数据</p>
</li>
<li>
<p>数量：有标签的数据：7M；合成数据：12M</p>
</li>
</ul>
<h2 id="评估和结果">评估和结果</h2>
<p>Massive Multilingual Text Embedding Benchmark (MMTEB)</p>
<ul>
<li>Qwen3-Embedding-4B/8B 模型表现最好</li>
<li>Qwen3-Embedding-0.6B 排在Gemini-Embedding之后，尽管只有0.6B的参数</li>
</ul>
<h2 id="消融实验">消融实验</h2>
<ol>
<li>仅仅在合成数据上训练的Qwen3-Embedding-0.6B 比最后的Qwen3-Embedding-0.6B模型效果要好。</li>
<li>把弱监督阶段去掉的话，最后的性能会下降。</li>
<li>如果不进行合并，Qwen3-Embedding-0.6B 的性能会明显下降；</li>
</ol>
<h1 id="术语和概念">术语和概念</h1>
<h2 id="因果注意力causal-attention">因果注意力（Causal Attention）</h2>
<p>Causal attention是一种自回归注意力机制，模型在生成每个词时只能看到它之前的词。这种机制通过一个上三角的 attention mask 实现。</p>
<p>注意力机制的区别</p>
<h2 id="rerank-方法">Rerank 方法</h2>
<ul>
<li>Point-wise</li>
<li>Pair-wise</li>
<li>List-wise</li>
</ul>
<h3 id="mrl">MRL</h3>
<p>（略）</p>
<h3 id="spherical-linear-interpolation-球状线性差值slerp">spherical linear interpolation 球状线性差值(slerp)</h3>
<p>（略）</p>
<h1 id="其他">其他</h1>
<ol>
<li>Persona Hub (地址：https://github.com/tencent-ailab/persona-hub）
我觉得这个项目很有意思，里面有3亿个拟人设定，例如环保主义者，历史学家，自然爱好者，老师，地理学家，学生，歌唱家等第。想象一下在虚拟世界里，这些人会干什么，会问什么问题？</li>
</ol>
<p>随便看两个人物设定：</p>
<p>对罗马帝国感兴趣的历史学家：</p>
<p>A historian or a scholar who is interested in the history of the Roman Empire, particularly the early years and the impact of Christianity on society. They are knowledgeable about the persecution of Christians in the Roman Empire and the story of Saint Maurice, the Roman soldier who refused to participate in pagan sacrifices and was eventually martyred. They are also interested in the concept of honor, courage, and faithfulness to one&rsquo;s beliefs, which are reflected in the story of Saint Maurice.</p>
<p>对医学术语感兴趣的人：</p>
<p>A person who is interested in medical terms and their meanings, particularly those related to cancer and medicine. They are likely to be a medical professional, a researcher, or a student who is studying the field of cancer biology. They are knowledgeable about the NCI Dictionary of Cancer Terms and are interested in learning more about parathyroid cancer and its related terms.</p>
<ol>
<li>比对挖掘（bitext mining）
比对挖掘（Bitext Mining）是一种自动从不同语言的文本中找出互为翻译的句子对的技术。它广泛应用于机器翻译、跨语言信息检索、多语言语料构建等领域。</li>
</ol>
<ul>
<li>里面的Bitext 是bilingually aligned text。</li>
<li>例子</li>
</ul>

  </article>
<div class="px-2 mb-2">
  
  <script src="https://utteranc.es/client.js"
    repo="HuizhiXu/huizhixu.github.io"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
  
</div>
<div class="bg-blue-100 dark:bg-gray-900">
  <div class="container px-4 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
    <div>
      <div class="text-2xl font-bold mb-2">Sein heißt werden, leben heißt lernen.</div>
      <p class="opacity-60">Der einfache Weg is immer verkehrt.</p>
    </div>

    <ul class="flex justify-center gap-x-3 flex-wrap gap-y-2">
      

      
      <li>
        <a
          href="https://twitter.com/"
          target="_blank"
          rel="noopener"
          aria-label="Twitter"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"
            />
          </svg>
        </a>
      </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      
      <li>
        <a
          href="https://github.com/"
          target="_blank"
          rel="noopener"
          aria-label="GitHub"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
            />
          </svg>
        </a>
      </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      
    </ul>
  </div>
</div>

    </main><footer class="container p-6 mx-auto flex justify-between items-center">
  <span class="text-sm font-light">
    
    Copyright © 2012 - Huizhi Xu · All rights reserved
    
  </span>
  <span onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="p-1 cursor-pointer">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5"
      stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M18 15l-6 -6l-6 6h12" />
    </svg>
  </span>
</footer>

<div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden">
  <div class="container max-w-3xl mx-auto p-12">
    <div class="relative">
      <div class="my-4 text-center text-2xl font-bold">Search</div>

      <span class="p-2 absolute right-0 top-0 cursor-pointer close-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </span>
    </div>

    <input type="search" class="py-2 px-3 w-full dark:text-black border dark:border-transparent"
      placeholder="Enter search query" />

    <div class="search-results text-lg font-medium my-4 hidden">Results</div>
    <ul class="search-list my-2">

    </ul>

    <div class="no-results text-center my-8 hidden">
      <div class="text-xl font-semibold mb-2">No results found</div>
      <p class="font-light text-sm">Try adjusting your search query</p>
    </div>
  </div>
</div>





<script src="https://huizhixu.github.io/js/scripts.min.js"></script>




<script>
  const languageMenuButton = document.querySelector('.language-switcher');
  const languageDropdown = document.querySelector('.language-dropdown');
  languageMenuButton.addEventListener('click', (evt) => {
    evt.preventDefault()
    if (languageDropdown.classList.contains('hidden')) {
      languageDropdown.classList.remove('hidden')
      languageDropdown.classList.add('flex')
    } else {
      languageDropdown.classList.add('hidden');
      languageDropdown.classList.remove('flex');
    }
  })
</script>



<script>
  
  const darkmode = document.querySelector('.toggle-dark-mode');
  function toggleDarkMode() {
    if (document.documentElement.classList.contains('dark')) {
      document.documentElement.classList.remove('dark')
      localStorage.setItem('darkmode', 'light')
    } else {
      document.documentElement.classList.add('dark')
      localStorage.setItem('darkmode', 'dark')
    }
  }
  if (darkmode) {
    darkmode.addEventListener('click', toggleDarkMode);
  }

  const darkStorage = localStorage.getItem('darkmode');
  const isBrowserDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

  if (!darkStorage && isBrowserDark) {
    document.documentElement.classList.add('dark');
  }

  if (darkStorage && darkStorage === 'dark') {
    toggleDarkMode();
  }
</script>


<script>
  const mobileMenuButton = document.querySelector('.mobile-menu-button')
  const mobileMenu = document.querySelector('.mobile-menu')
  function toggleMenu() {
    mobileMenu.classList.toggle('hidden');
    mobileMenu.classList.toggle('flex');
  }
  if(mobileMenu && mobileMenuButton){
    mobileMenuButton.addEventListener('click', toggleMenu)
  }
</script>
</body>
</html>
